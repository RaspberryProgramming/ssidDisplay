<html>
  <head>
    <link rel="stylesheet" type="text/css" href="site.css" />
    <link
      href="https://fonts.googleapis.com/css?family=VT323&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div id="about" style="display:none;">
      <p id="abouttitle">About Page</p>
      <p id="aboutinfo">
        Hey you found it, this should have an indent. If not oh well. There
        isn't much to this page but I'll outline a few key parts. Below you'll
        see a list of keys and their purposes. Keep them in mind.
      </p>
      <p id="keybindinfo">a: toggle autoscroll</p>
      <p id="keybindinfo">h: toggle about page</p>
    </div>
    <p id="title">
      Logged LOGS:
    </p>
    <div id="logs">
      <div id="text"></div>
      <p id="cursor" , style="display:hidden;">
        #
      </p>
    </div>
    <button onclick="autoscrollToggle()" id="asbtn">autoscroll: on</button>
  </body>
  <script src="/socket.io/socket.io.js"></script>

  <script>
    let autoscroll = true; // autoscroll is on by default
    let socket = io();
    let blink = 0;
    let aboutHidden = true;

    //functions
    function autoscrollToggle() {
      let elem = document.getElementById("asbtn");

      if (autoscroll) {
        autoscroll = false;
        elem.style.color = "brown";
        elem.style.backgroundColor = "red";
        elem.innerHTML = "autoscroll: Off";
      } else {
        autoscroll = true;
        elem.style.color = "lightblue";
        elem.style.backgroundColor = "green";
        elem.innerHTML = "autoscroll: On";
      }
    }

    function aboutToggle() {
      let elem = document.getElementById("about");
      console.log(elem.style.display);
      if (aboutHidden) {
        aboutHidden = false;
        elem.style.display = "";
        console.log("inherit");
      } else {
        aboutHidden = true;
        elem.style.display = "none";
        console.log("hidden");
      }
    }

    // Socket
    socket.on("init", function(msg) {
      console.log("init");
      var div = document.getElementById("text");
      for (log in msg.logs) {
        div.innerHTML += `<p>${msg.logs[log]}<\p>`;
      }
      div.scrollTop = div.scrollHeight;
    });
    socket.on("log", function(msg) {
      console.log(msg);
      var div = document.getElementById("text");
      div.innerHTML += `<p>${msg}<\p>`;

      if (!autoscroll) {
        blink = 2;
      }
    });

    // autoscroll
    window.setInterval(function() {
      if (autoscroll) {
        let elem = document.getElementById("logs");
        elem.scrollTop = elem.scrollHeight;
      }
    }, 500);

    window.setInterval(function() {
      if (blink > 0) {
        let elem = document.getElementById("logs");
        if (blink % 2 === 0) {
          elem.style.backgroundColor = "white";
        } else {
          elem.style.backgroundColor = document.querySelector(
            "logs.background-color"
          );
        }
        blink--;
      }
    }, 1000);

    window.setInterval(function() {
      let elem = document.getElementById("cursor");
      if (elem.style.color === "black") {
        let text = document.getElementById("text");
        elem.style.background = text.style.color;
        elem.style.color = text.style.color;
      } else {
        elem.style.background = "black";
        elem.style.color = "black";
      }
    }, 1000);
    //autoscroll toggle

    window.onkeypress = function(ev) {
      switch (ev.key) {
        case "a":
          autoscrollToggle();
          break;
        case "h":
          aboutToggle();
          break;
      }
    };

    socket.emit("requestLogs", "");
  </script>
</html>
